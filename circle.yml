machine:
  services:
    - docker
  environment:
    CGO_ENABLED: 0

dependencies:
  override:
    - go get -d
    - go build -o bin/tcd -installsuffix cgo
    #- go build -o bin/tcdclient client/client.go
    - docker build -t kinvolk/tcd .
  post:
    - rm -r ~/.gradle

test:
  override:
    - echo "Tests disabled"

deployment:
  privatehub:
    branch: master
    commands:
      - >
        test -z "${DOCKER_USER}" || (
          docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS &&
          (test "${DOCKER_ORGANIZATION:-$DOCKER_USER}" == "kinvolk" || docker tag kinvolk/tcd:demo1 ${DOCKER_ORGANIZATION:-$DOCKER_USER}/tcd:latest) &&
          docker push ${DOCKER_ORGANIZATION:-$DOCKER_USER}/tcd &&
          docker images
        )
